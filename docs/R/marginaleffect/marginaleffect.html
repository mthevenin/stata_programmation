<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.179">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marc Thevenin">
<meta name="dcterms.date" content="2022-10-07">

<title>Effets marginaux</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://mthevenin.github.io/stata_fr/" rel="" target="">
 <span class="menu-text">Stata Ined</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mthevenin.github.io/stata_graphiques/" rel="" target="">
 <span class="menu-text">Graphiques</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mthevenin.github.io/stata_programmation/" rel="" target="">
 <span class="menu-text">Programmation</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mthevenin" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:marc.thevenin@ined.fr" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">A propos</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Effets marginaux</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Formation introductive</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../formation/chapitre0.html" class="sidebar-item-text sidebar-link">Présentation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../formation/chapitre1.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../formation/chapitre2.html" class="sidebar-item-text sidebar-link">Environnement</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../formation/chapitre3.html" class="sidebar-item-text sidebar-link">Le langage Stata</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../formation/chapitre4.html" class="sidebar-item-text sidebar-link">Les bases de données</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../formation/chapitre5.html" class="sidebar-item-text sidebar-link">Les variables</a>
  </div>
</li>
          <li class="sidebar-item">
  formation/chapitre6.qmd
  </li>
          <li class="sidebar-item">
  formation/chapitre7.qmd
  </li>
          <li class="sidebar-item">
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Fichier profile</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../profile/profile1.html" class="sidebar-item-text sidebar-link">Principe</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../profile/profile2.html" class="sidebar-item-text sidebar-link">Exemple profile.do</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Need for speed</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../speedup/gtools/gtools.html" class="sidebar-item-text sidebar-link">Gtools</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../speedup/frame/frame.html" class="sidebar-item-text sidebar-link">Frame</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">Super Macro World</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../macro/intro.html" class="sidebar-item-text sidebar-link">Présentation</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">C’est dans l’R</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../R.html" class="sidebar-item-text sidebar-link">Stata et R</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">Edition des outputs</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tableaux/intro.html" class="sidebar-item-text sidebar-link">Intro - Collect</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#margins-et-marginaleffects" id="toc-margins-et-marginaleffects" class="nav-link active" data-scroll-target="#margins-et-marginaleffects"><span class="toc-section-number">1</span>  <strong>margins</strong> et <strong>marginaleffects</strong></a></li>
  <li><a href="#exemples-pour-le-calcul-des-ame" id="toc-exemples-pour-le-calcul-des-ame" class="nav-link" data-scroll-target="#exemples-pour-le-calcul-des-ame"><span class="toc-section-number">2</span>  Exemples pour le calcul des AME</a>
  <ul class="collapse">
  <li><a href="#modèle-logit-binaire" id="toc-modèle-logit-binaire" class="nav-link" data-scroll-target="#modèle-logit-binaire"><span class="toc-section-number">2.1</span>  Modèle logit (binaire)</a></li>
  <li><a href="#modèle-ordinal-odds-proportionnels" id="toc-modèle-ordinal-odds-proportionnels" class="nav-link" data-scroll-target="#modèle-ordinal-odds-proportionnels"><span class="toc-section-number">2.2</span>  Modèle ordinal (odds proportionnels)</a></li>
  <li><a href="#modèle-multinomial-logistique" id="toc-modèle-multinomial-logistique" class="nav-link" data-scroll-target="#modèle-multinomial-logistique"><span class="toc-section-number">2.3</span>  Modèle multinomial (logistique)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Effets marginaux</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Regression</div>
    <div class="quarto-category">Marginal effect</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Marc Thevenin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 7, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="margins-et-marginaleffects" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> <strong>margins</strong> et <strong>marginaleffects</strong></h1>
<p><strong>Package <code>margins</code> (2015? -)</strong></p>
<ul>
<li>Auteur: <strong><em>TJ.Leeper &amp; al</em></strong></li>
<li>Package maintenant assez ancien, peu ou pas de mise à jours récentes.</li>
<li>Documentation: <a href="https://cran.r-project.org/web/packages/margins/vignettes/Introduction.html">Lien</a></li>
<li>Assez embêtant à l’Ined: estimation des AME impossible pour le modèle multinomial logistique (non conditionnel) avec la fonction <code>multinom</code> du pkg <code>nnet</code></li>
</ul>
<p><strong>Package <code>marginaleffects</code> (2021-)</strong></p>
<ul>
<li>Auteur: <strong><em>VA.Bundock</em></strong></li>
<li>Depuis septembre 2021. Mises à jour régulières</li>
<li>Documentation très riche: <a href="https://vincentarelbundock.github.io/marginaleffects/index.html">Lien</a></li>
<li>On l’attendait…estime les AME après un modèle multinomial logistique (non conditionnel) avec la fonction <code>multinom</code> du pkg <code>nnet</code>
<ul>
<li>Packages et fonctions prises en charge (&gt;100): <a href="https://vincentarelbundock.github.io/marginaleffects/articles/supported_models.html">Lien</a></li>
<li>Notes de version (important): <a href="https://vincentarelbundock.github.io/marginaleffects/news/index.html">Lien</a></li>
<li>L’auteur propose également un package pour éditer les outputs <strong><code>modelsummary</code></strong>. Je n’y trouve pas encore mon compte, en particulier pour la sélection d’AME d’un sous ensemble d’outcomes pour un modèle de type ordinal ou multinomial. Les output sont pour l’instant édité de manière brute (il restent très lisibles).</li>
</ul></li>
</ul>
<p><strong>Installation des packages</strong></p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>margins</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"margins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>marginalffects</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"marginseffects"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ou </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"vincentarelbundock/marginaleffects"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(margins)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ordinal)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exemples-pour-le-calcul-des-ame" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Exemples pour le calcul des AME</h1>
<p>Base: petit extrait de la bases <em>nhanes2</em> (épidemio)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"D:/D/Marc/SMS/STATA INED/Programmation/R/marginaleffect/nhanes.csv"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>hlthstat <span class="ot">=</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>hlthstat)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="modèle-logit-binaire" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="modèle-logit-binaire"><span class="header-section-number">2.1</span> Modèle logit (binaire)</h2>
<p><strong>Estimation du modèle</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">glm</span>(highbp <span class="sc">~</span> female <span class="sc">+</span> black <span class="sc">+</span> bmi, <span class="at">family=</span>binomial, <span class="at">data=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Calcul des AME</strong></p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Stata - margins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">R - margins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">R - marginaleffects</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-collectcode="true">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">use</span> <span class="st">"D:\D\Marc\SMS\STATA INED\Programmation\R\marginaleffect</span><span class="ch">\n</span><span class="st">hanes.dta"</span> , <span class="kw">clear</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">logit</span> highbp female <span class="bn">black</span> bmi </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>margins, <span class="kw">dydx</span>(*) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; , clear



Average marginal effects                                Number of obs = 10,335
Model VCE: OIM

Expression: Pr(highbp), predict()
dy/dx wrt:  female black bmi

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
      female |     -0.087      0.009    -9.65   0.000       -0.105      -0.069
       black |      0.045      0.015     3.02   0.003        0.016       0.074
         bmi |      0.032      0.001    36.31   0.000        0.030       0.034
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ame <span class="ot">=</span> <span class="fu">margins</span>(fit)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> factor     AME     SE       z      p   lower   upper
  black  0.0450 0.0149  3.0209 0.0025  0.0158  0.0742
    bmi  0.0321 0.0009 36.3104 0.0000  0.0304  0.0338
 female -0.0871 0.0090 -9.6499 0.0000 -0.1048 -0.0694</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ame <span class="ot">=</span> <span class="fu">marginaleffects</span>(fit)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Term   Effect Std. Error z value   Pr(&gt;|z|)    2.5 %   97.5 %
1 female -0.08710  0.0090267  -9.650 &lt; 2.22e-16 -0.10480 -0.06941
2  black  0.04498  0.0148897   3.021  0.0025201  0.01580  0.07416
3    bmi  0.03212  0.0008831  36.371 &lt; 2.22e-16  0.03039  0.03385

Model type:  glm 
Prediction type:  response </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="modèle-ordinal-odds-proportionnels" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="modèle-ordinal-odds-proportionnels"><span class="header-section-number">2.2</span> Modèle ordinal (odds proportionnels)</h2>
<p>Seulement avec <code>margineffects</code> pour R</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Stata - margins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">R - margineffects</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-collectcode="true">
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">ologit</span> hlthstat female <span class="bn">black</span> bmi </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>margins, <span class="kw">dydx</span>(*) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average marginal effects                                Number of obs = 10,335
Model VCE: OIM

dy/dx wrt: female black bmi

1._predict: Pr(hlthstat==1), predict(pr outcome(1))
2._predict: Pr(hlthstat==2), predict(pr outcome(2))
3._predict: Pr(hlthstat==3), predict(pr outcome(3))
4._predict: Pr(hlthstat==4), predict(pr outcome(4))
5._predict: Pr(hlthstat==5), predict(pr outcome(5))

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
female       |
    _predict |
          1  |  -.0235471   .0062116    -3.79   0.000    -.0357216   -.0113726
          2  |  -.0089765   .0023674    -3.79   0.000    -.0136165   -.0043365
          3  |   .0093555   .0024826     3.77   0.000     .0044896    .0142214
          4  |   .0145253   .0038254     3.80   0.000     .0070276    .0220229
          5  |   .0086428   .0022926     3.77   0.000     .0041493    .0131363
-------------+----------------------------------------------------------------
black        |
    _predict |
          1  |  -.1206233   .0102194   -11.80   0.000    -.1406529   -.1005936
          2  |  -.0459833   .0039391   -11.67   0.000    -.0537038   -.0382628
          3  |   .0479248   .0042586    11.25   0.000     .0395781    .0562716
          4  |   .0744078   .0062401    11.92   0.000     .0621774    .0866383
          5  |   .0442739    .003994    11.08   0.000     .0364457    .0521021
-------------+----------------------------------------------------------------
bmi          |
    _predict |
          1  |  -.0088687   .0006413   -13.83   0.000    -.0101257   -.0076117
          2  |  -.0033809     .00025   -13.52   0.000    -.0038709   -.0028908
          3  |   .0035236   .0002694    13.08   0.000     .0029956    .0040517
          4  |   .0054707   .0003941    13.88   0.000     .0046983    .0062432
          5  |   .0032552   .0002564    12.69   0.000     .0027526    .0037578
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>J’utilise la fonction <strong><code>clm</code></strong> du package <code>ordinal</code> pour estimer le modèle.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">clm</span>(hlthstat <span class="sc">~</span> female <span class="sc">+</span> black <span class="sc">+</span> bmi, <span class="at">family=</span>binomial, <span class="at">data=</span>df)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ame <span class="ot">=</span> <span class="fu">marginaleffects</span>(fit)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Group   Term    Effect Std. Error z value   Pr(&gt;|z|)     2.5 %    97.5 %
1      1 female -0.023547  0.0062114  -3.791 0.00015008 -0.035721 -0.011373
2      1  black -0.120621  0.0102190 -11.804 &lt; 2.22e-16 -0.140650 -0.100592
3      1    bmi -0.008868  0.0006404 -13.848 &lt; 2.22e-16 -0.010123 -0.007613
4      2 female -0.008977  0.0023676  -3.791 0.00014978 -0.013617 -0.004336
5      2  black -0.045985  0.0039405 -11.670 &lt; 2.22e-16 -0.053709 -0.038262
6      2    bmi -0.003381  0.0002502 -13.517 &lt; 2.22e-16 -0.003872 -0.002891
7      3 female  0.009355  0.0024824   3.769 0.00016409  0.004490  0.014221
8      3  black  0.047923  0.0042588  11.252 &lt; 2.22e-16  0.039575  0.056270
9      3    bmi  0.003523  0.0002680  13.145 &lt; 2.22e-16  0.002998  0.004048
10     4 female  0.014525  0.0038255   3.797 0.00014646  0.007028  0.022023
11     4  black  0.074409  0.0062407  11.923 &lt; 2.22e-16  0.062177  0.086640
12     4    bmi  0.005471  0.0003941  13.883 &lt; 2.22e-16  0.004699  0.006243
13     5 female  0.008643  0.0022928   3.770 0.00016351  0.004149  0.013137
14     5  black  0.044275  0.0039941  11.085 &lt; 2.22e-16  0.036447  0.052104
15     5    bmi  0.003256  0.0002571  12.660 &lt; 2.22e-16  0.002752  0.003760

Model type:  clm 
Prediction type:  prob </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Niveau output cela se complique pour sélectionner un ou un sous ensemble d’outcome…On va y arriver.</p>
</section>
<section id="modèle-multinomial-logistique" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="modèle-multinomial-logistique"><span class="header-section-number">2.3</span> Modèle multinomial (logistique)</h2>
<p><strong><em>Remarque</em></strong>: l’estimation des AME avec un modèle multinomial de type <em>stereotype logit model</em>, adapté aux variables à structure ordinale n’est pas possible avec <code>marginaleffects</code> (modèle estimé avec le pck <code>VGAM</code>). Avec Stata, il est estimé avec la commande <strong><code>slogit</code></strong>.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Stata - margins</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">R - marginaleffects</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-collectcode="true">
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">mlogit</span> hlthstat female <span class="bn">black</span> bmi </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>margins, <span class="kw">dydx</span>(*) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average marginal effects                                Number of obs = 10,335
Model VCE: OIM

dy/dx wrt: female black bmi

1._predict: Pr(hlthstat==Excellent), predict(pr outcome(1))
2._predict: Pr(hlthstat==Very_good), predict(pr outcome(2))
3._predict: Pr(hlthstat==Good), predict(pr outcome(3))
4._predict: Pr(hlthstat==Fair), predict(pr outcome(4))
5._predict: Pr(hlthstat==Poor), predict(pr outcome(5))

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
female       |
    _predict |
          1  |  -.0435641   .0082163    -5.30   0.000    -.0596679   -.0274604
          2  |   .0088463    .008501     1.04   0.298    -.0078154    .0255081
          3  |   .0233105   .0088631     2.63   0.009     .0059391    .0406819
          4  |   .0261863   .0072332     3.62   0.000     .0120095     .040363
          5  |   -.014779   .0050284    -2.94   0.003    -.0246345   -.0049235
-------------+----------------------------------------------------------------
black        |
    _predict |
          1  |  -.1107437   .0162243    -6.83   0.000    -.1425427   -.0789447
          2  |  -.0668401   .0155164    -4.31   0.000    -.0972515   -.0364286
          3  |   .0635409   .0141258     4.50   0.000     .0358548     .091227
          4  |    .060461   .0105785     5.72   0.000     .0397274    .0811946
          5  |   .0535818   .0065457     8.19   0.000     .0407524    .0664112
-------------+----------------------------------------------------------------
bmi          |
    _predict |
          1  |  -.0100225   .0009394   -10.67   0.000    -.0118636   -.0081814
          2  |  -.0026028   .0008992    -2.89   0.004    -.0043652   -.0008403
          3  |   .0037662   .0008894     4.23   0.000     .0020231    .0055094
          4  |    .006369   .0006729     9.46   0.000     .0050501    .0076879
          5  |   .0024901   .0004731     5.26   0.000     .0015627    .0034174
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">multinom</span>(hlthstat <span class="sc">~</span> female <span class="sc">+</span> black <span class="sc">+</span> bmi,  <span class="at">data=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  25 (16 variable)
initial  value 16633.540825 
iter  10 value 15780.594333
iter  20 value 15554.684483
final  value 15554.562787 
converged</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ame <span class="ot">=</span> <span class="fu">marginaleffects</span>(fit)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Group   Term    Effect Std. Error z value   Pr(&gt;|z|)     2.5 %     97.5 %
1      1 female -0.043564  0.0082163  -5.302 1.1446e-07 -0.059667 -0.0274602
2      1  black -0.110741  0.0162240  -6.826 8.7472e-12 -0.142539 -0.0789423
3      1    bmi -0.010022  0.0009399 -10.662 &lt; 2.22e-16 -0.011864 -0.0081797
4      2 female  0.008846  0.0085013   1.041  0.2980980 -0.007816  0.0255079
5      2  black -0.066842  0.0155161  -4.308 1.6480e-05 -0.097253 -0.0364309
6      2    bmi -0.002603  0.0009004  -2.891  0.0038367 -0.004368 -0.0008385
7      3 female  0.023310  0.0088633   2.630  0.0085410  0.005938  0.0406815
8      3  black  0.063540  0.0141261   4.498 6.8587e-06  0.035853  0.0912261
9      3    bmi  0.003766  0.0008902   4.230 2.3339e-05  0.002021  0.0055105
10     4 female  0.026186  0.0072335   3.620  0.0002945  0.012009  0.0403633
11     4  black  0.060460  0.0105788   5.715 1.0957e-08  0.039726  0.0811939
12     4    bmi  0.006369  0.0006743   9.446 &lt; 2.22e-16  0.005048  0.0076909
13     5 female -0.014778  0.0050287  -2.939  0.0032963 -0.024634 -0.0049216
14     5  black  0.053583  0.0065455   8.186 2.6955e-16  0.040754  0.0664120
15     5    bmi  0.002490  0.0004746   5.247 1.5489e-07  0.001560  0.0034202

Model type:  multinom 
Prediction type:  probs </code></pre>
</div>
</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Marc Thévenin - Ined-Sms - Août 2022</div>
  </div>
</footer>



</body></html>